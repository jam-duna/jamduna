<!DOCTYPE html><meta charset="utf-8" />
<title>Frame Viewer</title>
<style>
 body{background:#121212;color:#fafafa;font:16px system-ui;margin:0;display:flex;flex-direction:column;align-items:center}
 canvas{border:1px solid #555;margin-top:8px;image-rendering:pixelated}
</style>
<h2>Frame Viewer</h2>
<canvas id=cv width=640 height=400></canvas>
<p id=msg>Connecting…</p>
<script>
const w=640,h=400,BPP=4,
      ctx=document.getElementById('cv').getContext('2d'),
      msg=document.getElementById('msg');

const proto = location.protocol==="https:"?"wss":"ws";
const ws = new WebSocket(`${proto}://${location.host}/ws`);
ws.binaryType = "arraybuffer";

ws.onopen   = () => msg.textContent="Waiting for frame…";
ws.onerror  = e  => msg.textContent="WS error";
ws.onclose  = () => msg.textContent="Closed";

ws.onmessage = ev=>{
  const buf = ev.data;
  if(buf.byteLength!==w*h*BPP){
    msg.textContent=`Size mismatch ${buf.byteLength}`;
    return;
  }
  const s=new Uint8Array(buf),d=new Uint8ClampedArray(s.length);
  for(let i=0;i<s.length;i+=4){ d[i]=s[i+2]; d[i+1]=s[i+1]; d[i+2]=s[i]; d[i+3]=255; }
  ctx.putImageData(new ImageData(d,w,h),0,0);
  msg.textContent="";
};
</script>
